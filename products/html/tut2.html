<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nim æ•™ç¨‹ (ç¬¬ II éƒ¨åˆ†)</title>

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<link rel="stylesheet" type="text/css" href="nimdoc.out.css">

<!-- JS -->
<script type="text/javascript" src="dochack.js"></script>
</head>
<body>
  <div class="document" id="documentId">
    <div class="container">
      <h1 class="title">Nim æ•™ç¨‹ (ç¬¬ II éƒ¨åˆ†)</h1>
      <div class="row">
  <div class="three columns">
    <div class="theme-select-wrapper">
      <label for="theme-select">Theme:&nbsp;</label>
      <select id="theme-select" onchange="setTheme(this.value)">
        <option value="auto">ğŸŒ— Match OS</option>
        <option value="dark">ğŸŒ‘ Dark</option>
        <option value="light">ğŸŒ• Light</option>
      </select>
    </div>
    <div id="global-links">
      <ul class="simple">
        <li><a href="theindex.html">Index</a></li>
      </ul>
    </div>
    <div id="searchInputDiv">
      Search: <input type="search" id="searchInput" onkeyup="search()"/>
    </div>
    <div>
      Group by:
      <select onchange="groupBy(this.value)">
        <option value="section">Section</option>
        <option value="type">Type</option>
      </select>
    </div>
    <ul class="simple simple-toc" id="toc-list">
  <li><a class="reference" id="å¼•è¨€_toc" href="#å¼•è¨€">å¼•è¨€</a></li>
<li><a class="reference" id="ç¼–è¯‘æŒ‡ç¤º_toc" href="#ç¼–è¯‘æŒ‡ç¤º">ç¼–è¯‘æŒ‡ç¤º</a></li>
<li><a class="reference" id="é¢å‘å¯¹è±¡ç¼–ç¨‹_toc" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹">é¢å‘å¯¹è±¡ç¼–ç¨‹</a></li>
<ul class="simple"><li><a class="reference" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-ç»§æ‰¿_toc" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-ç»§æ‰¿">ç»§æ‰¿</a></li>
<li><a class="reference" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-ç›¸äº’é€’å½’ç±»å‹_toc" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-ç›¸äº’é€’å½’ç±»å‹">ç›¸äº’é€’å½’ç±»å‹</a></li>
<li><a class="reference" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-ç±»å‹è½¬æ¢_toc" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-ç±»å‹è½¬æ¢">ç±»å‹è½¬æ¢</a></li>
<li><a class="reference" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-å¯¹è±¡å˜ä½“_toc" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-å¯¹è±¡å˜ä½“">å¯¹è±¡å˜ä½“</a></li>
<li><a class="reference" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-æ–¹æ³•è°ƒç”¨è¯­æ³•_toc" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-æ–¹æ³•è°ƒç”¨è¯­æ³•">æ–¹æ³•è°ƒç”¨è¯­æ³•</a></li>
<li><a class="reference" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-å±æ€§_toc" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-å±æ€§">å±æ€§</a></li>
<li><a class="reference" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-åŠ¨æ€åˆ†å‘_toc" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-åŠ¨æ€åˆ†å‘">åŠ¨æ€åˆ†å‘</a></li>
</ul><li><a class="reference" id="å¼‚å¸¸_toc" href="#å¼‚å¸¸">å¼‚å¸¸</a></li>
<ul class="simple"><li><a class="reference" id="å¼‚å¸¸-raise-è¯­å¥_toc" href="#å¼‚å¸¸-raise-è¯­å¥">Raise è¯­å¥</a></li>
<li><a class="reference" id="å¼‚å¸¸-try-è¯­å¥_toc" href="#å¼‚å¸¸-try-è¯­å¥">Try è¯­å¥</a></li>
<li><a class="reference" id="å¼‚å¸¸-ç”¨-raised-exceptions-æ³¨è§£è¿‡ç¨‹_toc" href="#å¼‚å¸¸-ç”¨-raised-exceptions-æ³¨è§£è¿‡ç¨‹">ç”¨ raised exceptions æ³¨è§£è¿‡ç¨‹</a></li>
</ul><li><a class="reference" id="æ³›å‹_toc" href="#æ³›å‹">æ³›å‹</a></li>
<li><a class="reference" id="æ¨¡æ¿_toc" href="#æ¨¡æ¿">æ¨¡æ¿</a></li>
<ul class="simple"><li><a class="reference" id="æ¨¡æ¿-ä¾‹colon-æå‡è¿‡ç¨‹_toc" href="#æ¨¡æ¿-ä¾‹colon-æå‡è¿‡ç¨‹">ä¾‹: æå‡è¿‡ç¨‹</a></li>
</ul><li><a class="reference" id="ç¼–è¯‘æˆ-javascript_toc" href="#ç¼–è¯‘æˆ-javascript">ç¼–è¯‘æˆ JavaScript</a></li>
<li><a class="reference" id="ç¬¬-3-éƒ¨åˆ†_toc" href="#ç¬¬-3-éƒ¨åˆ†">ç¬¬ 3 éƒ¨åˆ†</a></li>

</ul>

  </div>
  <div class="nine columns" id="content">
    
    <div id="tocRoot"></div>
    
    <p class="module-desc"><table class="docinfo" frame="void" rules="none"><col class="docinfo-name" /><col class="docinfo-content" /><tbody valign="top"><tr><th class="docinfo-name">Author:</th><td>Andreas Rumpf</td></tr>
<tr><th class="docinfo-name">Version:</th><td>|nimversion|</td></tr>
</tbody></table>
<h1><a class="toc-backref" id="å¼•è¨€" href="#å¼•è¨€">å¼•è¨€</a></h1><blockquote class="markdown-quote"><p>&quot;Repetition renders the ridiculous reasonable.&quot; -- Norman Wildberger</p></blockquote>
<p>æœ¬æ–‡æ¡£æ˜¯æœ‰å…³ <em>Nim</em> ç¼–ç¨‹è¯­è¨€é«˜çº§éƒ¨åˆ†çš„æ•™ç¨‹ã€‚<strong>è¯·æ³¨æ„ï¼Œæ­¤æ–‡æ¡£æœ‰äº›è¿‡æ—¶ï¼Œä½†</strong> <a class="reference external" href="manual.html">æ‰‹å†Œ</a> <strong>ä¸­åŒ…å«æ›´å¤šé«˜çº§è¯­è¨€åŠŸèƒ½çš„ç¤ºä¾‹ã€‚</strong></p>

<h1><a class="toc-backref" id="ç¼–è¯‘æŒ‡ç¤º" href="#ç¼–è¯‘æŒ‡ç¤º">ç¼–è¯‘æŒ‡ç¤º</a></h1><p>ç¼–è¯‘æŒ‡ç¤ºæ˜¯ Nim ä¸ºç¼–è¯‘å™¨æä¾›é¢å¤–ä¿¡æ¯ / å‘½ä»¤è€Œä¸å¼•å…¥å¤§é‡æ–°å…³é”®å­—çš„æ–¹æ³•ã€‚ ç¼–è¯‘æŒ‡ç¤ºåŒ…å«åœ¨ç‰¹æ®Šçš„ <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span></span></tt> å’Œ <tt class="docutils literal"><span class="pre"><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> å¤§æ‹¬å·ä¸­ã€‚æœ¬æ•™ç¨‹ä¸æ¶‰åŠç¼–è¯‘æŒ‡ç¤ºçš„å†…å®¹ã€‚ è¯¦æƒ…è¯·å‚é˜… <a class="reference external" href="manual.html#pragmas">æ‰‹å†Œ</a> æˆ– <a class="reference external" href=" nimc.html#additional-features">ç”¨æˆ·æŒ‡å¯¼</a> ä»¥äº†è§£å¯ç”¨çš„ç¼–è¯‘æŒ‡ç¤ºã€‚</p>

<h1><a class="toc-backref" id="é¢å‘å¯¹è±¡ç¼–ç¨‹" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹">é¢å‘å¯¹è±¡ç¼–ç¨‹</a></h1><p>è™½ç„¶ Nim å¯¹é¢å‘å¯¹è±¡ç¼–ç¨‹ (OOP) çš„æ”¯æŒå¾ˆç®€å•ï¼Œä½†ä½ ä»å¯ä½¿ç”¨å¼ºå¤§çš„ OOP æŠ€æœ¯ã€‚ OOP è¢«è§†ä¸ºè®¾è®¡ç¨‹åºçš„<em>ä¸€ç§</em>æ–¹å¼ï¼Œè€Œé<em>å”¯ä¸€</em>æ–¹å¼ã€‚é€šå¸¸ï¼Œä½¿ç”¨è¿‡ç¨‹èƒ½å†™å‡ºæ›´ç®€å•æœ‰æ•ˆçš„ä»£ç ã€‚ å°¤å…¶æ˜¯åœ¨è®¾è®¡ä¸Šï¼Œé¦–é€‰ç»„åˆæ¯”ç»§æ‰¿æ›´å¥½ã€‚</p>

<h2><a class="toc-backref" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-ç»§æ‰¿" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-ç»§æ‰¿">ç»§æ‰¿</a></h2><p>Nim ä¸­çš„ç»§æ‰¿å®Œå…¨æ˜¯å¯é€‰çš„ã€‚è¦ä½¿ç”¨ç»§æ‰¿å¹¶å¯ç”¨è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯ï¼Œå¯¹è±¡éœ€ä» <tt class="docutils literal"><span class="pre"><span class="Identifier">RootObj</span></span></tt> ç»§æ‰¿ã€‚ è¿™å¯ä»¥é€šè¿‡ç›´æ¥ç»§æ‰¿æˆ–é—´æ¥åœ°ç»§æ‰¿ç»§æ‰¿äº† <tt class="docutils literal"><span class="pre"><span class="Identifier">RootObj</span></span></tt> çš„å¯¹è±¡æ¥å®Œæˆã€‚å°½ç®¡å°†ä½¿ç”¨äº†ç»§æ‰¿çš„ç±»å‹ æ ‡è®°ä¸º <tt class="docutils literal"><span class="pre"><span class="Keyword">ref</span></span></tt> ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œä½†è¿™æ˜¯æƒ¯ç”¨æ³•ã€‚è¦åœ¨è¿è¡Œæ—¶æ£€æŸ¥å¯¹è±¡æ˜¯å¦å±äºæŸç§ç±»å‹ï¼Œå¯ç”¨ <tt class="docutils literal"><span class="pre"><span class="Keyword">of</span></span></tt> è¿ç®—ç¬¦ã€‚</p>
<p><pre class="listing">
<span class="Keyword">type</span>
  <span class="Identifier">Person</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">RootObj</span>
    <span class="Identifier">name</span><span class="Operator">*:</span> <span class="Identifier">string</span>  <span class="Comment"># the * means that `name` is accessible from other modules</span>
    <span class="Identifier">age</span><span class="Punctuation">:</span> <span class="Identifier">int</span>       <span class="Comment"># no * means that the field is hidden from other modules</span>
  
  <span class="Identifier">Student</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Person</span> <span class="Comment"># Student inherits from Person</span>
    <span class="Identifier">id</span><span class="Punctuation">:</span> <span class="Identifier">int</span>                      <span class="Comment"># with an id field</span>

<span class="Keyword">var</span>
  <span class="Identifier">student</span><span class="Punctuation">:</span> <span class="Identifier">Student</span>
  <span class="Identifier">person</span><span class="Punctuation">:</span> <span class="Identifier">Person</span>
<span class="Identifier">assert</span><span class="Punctuation">(</span><span class="Identifier">student</span> <span class="Keyword">of</span> <span class="Identifier">Student</span><span class="Punctuation">)</span> <span class="Comment"># is true</span>
<span class="Comment"># object construction:</span>
<span class="Identifier">student</span> <span class="Operator">=</span> <span class="Identifier">Student</span><span class="Punctuation">(</span><span class="Identifier">name</span><span class="Punctuation">:</span> <span class="StringLit">&quot;Anton&quot;</span><span class="Punctuation">,</span> <span class="Identifier">age</span><span class="Punctuation">:</span> <span class="DecNumber">5</span><span class="Punctuation">,</span> <span class="Identifier">id</span><span class="Punctuation">:</span> <span class="DecNumber">2</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span> <span class="Identifier">student</span><span class="Punctuation">[</span><span class="Punctuation">]</span></pre></p>
<p>ç»§æ‰¿æ˜¯ä½¿ç”¨ <tt class="docutils literal"><span class="pre"><span class="Keyword">object</span> <span class="Keyword">of</span></span></tt> è¯­æ³•å®Œæˆçš„ã€‚å½“å‰ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ç±»å‹æ²¡æœ‰åˆé€‚çš„çˆ¶ç±»ï¼Œ å¯ä»¥é€‰æ‹© <tt class="docutils literal"><span class="pre"><span class="Identifier">RootObj</span></span></tt> ä½œä¸ºå®ƒçš„çˆ¶ç±»ï¼Œä½†è¿™åªæ˜¯ä¸€ä¸ªçº¦å®šã€‚æ²¡æœ‰çˆ¶ç±»çš„å¯¹è±¡è¢«éšå¼è®¾ç½®ä¸º <tt class="docutils literal"><span class="pre"><span class="Identifier">final</span></span></tt>ã€‚ ä½ å¯ç”¨ <tt class="docutils literal"><span class="pre"><span class="Identifier">inheritable</span></span></tt> ç¼–è¯‘æŒ‡ç¤ºæ¥å¼•å…¥é™¤ <tt class="docutils literal"><span class="pre"><span class="Identifier">system</span><span class="Operator">.</span><span class="Identifier">RootObj</span></span></tt> ä¹‹å¤–çš„æ–°å¯¹è±¡æ ¹ã€‚ (ä¾‹å¦‚ï¼Œè¿™åœ¨ GTK åŒ…è£…å™¨ä¸­ä½¿ç”¨)</p>
<p>æ¯å½“ä½¿ç”¨ç»§æ‰¿æ—¶ï¼Œéƒ½åº”è¯¥ä½¿ç”¨ Ref å¯¹è±¡ã€‚è¿™ä¸æ˜¯ç»å¯¹å¿…è¦çš„ï¼Œä½†æ˜¯å¯¹äºé ref å¯¹è±¡ï¼Œè¯¸å¦‚ <tt class="docutils literal"><span class="pre"><span class="Keyword">let</span> <span class="Identifier">person</span><span class="Punctuation">:</span> <span class="Identifier">Person</span> <span class="Operator">=</span> <span class="Identifier">Student</span><span class="Punctuation">(</span><span class="Identifier">id</span><span class="Punctuation">:</span> <span class="DecNumber">123</span><span class="Punctuation">)</span></span></tt> ä¹‹ç±»çš„èµ‹å€¼å°†æˆªæ–­å­ç±»å­—æ®µã€‚</p>
<p><strong>æ³¨æ„</strong>: å¯¹äºç®€å•çš„ä»£ç é‡ç”¨ï¼Œç»„åˆ(<em>has-a</em> å…³ç³»)é€šå¸¸ä¼˜äºç»§æ‰¿(<em>is-a</em> å…³ç³»)ã€‚ ç”±äºå¯¹è±¡åœ¨ Nim ä¸­æ˜¯å€¼ç±»å‹ï¼Œå› æ­¤ç»„åˆä¸ç»§æ‰¿ä¸€æ ·é«˜æ•ˆã€‚</p>

<h2><a class="toc-backref" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-ç›¸äº’é€’å½’ç±»å‹" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-ç›¸äº’é€’å½’ç±»å‹">ç›¸äº’é€’å½’ç±»å‹</a></h2><p>å¯¹è±¡ã€å…ƒç»„å’Œå¼•ç”¨å¯ä»¥æ¨¡æ‹Ÿç›¸äº’ä¾èµ–çš„éå¸¸å¤æ‚çš„æ•°æ®ç»“æ„; åœ¨ä¸€ä¸ªå£°æ˜å—ä¸­å£°æ˜çš„ç±»å‹æ˜¯<em>ç›¸äº’é€’å½’</em>å¯çŸ¥çš„ã€‚(å…¶ä»–ç±»å‹éƒ½éœ€è¦æå‰å£°æ˜ç›¸åº”ç¬¦å·ï¼Œè¿™å°†å‡æ…¢ç¼–è¯‘é€Ÿåº¦)</p>
<p>ä¾‹:</p>
<p><pre class="listing">
<span class="Keyword">type</span>
  <span class="Identifier">Node</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span>  <span class="Comment"># a reference to an object with the following field:</span>
    <span class="Identifier">le</span><span class="Punctuation">,</span> <span class="Identifier">ri</span><span class="Punctuation">:</span> <span class="Identifier">Node</span>     <span class="Comment"># left and right subtrees</span>
    <span class="Identifier">sym</span><span class="Punctuation">:</span> <span class="Keyword">ref</span> <span class="Identifier">Sym</span>     <span class="Comment"># leaves contain a reference to a Sym</span>
  
  <span class="Identifier">Sym</span> <span class="Operator">=</span> <span class="Keyword">object</span>       <span class="Comment"># a symbol</span>
    <span class="Identifier">name</span><span class="Punctuation">:</span> <span class="Identifier">string</span>     <span class="Comment"># the symbol's name</span>
    <span class="Identifier">line</span><span class="Punctuation">:</span> <span class="Identifier">int</span>        <span class="Comment"># the line the symbol was declared in</span>
    <span class="Identifier">code</span><span class="Punctuation">:</span> <span class="Identifier">Node</span>       <span class="Comment"># the symbol's abstract syntax tree</span></pre></p>

<h2><a class="toc-backref" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-ç±»å‹è½¬æ¢" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-ç±»å‹è½¬æ¢">ç±»å‹è½¬æ¢</a></h2><p>Nim åŒºåˆ† <span id="type-cast_1">type cast</span> å’Œ <tt class="docutils literal"><span class="pre"><span class="Keyword">type</span> <span class="Identifier">conversions</span></span></tt>:idx:ã€‚ <tt class="docutils literal"><span class="pre"><span class="Keyword">cast</span></span></tt> è¿ç®—ç¬¦å¯ç”¨äºç±»å‹å¼ºè½¬ï¼Œå¼ºåˆ¶ç¼–è¯‘å™¨å°†ä¸€ç§ç±»å‹çš„ä½æ ¼å¼å¼ºè½¬ä¸ºå¦ä¸€ç§ç±»å‹ã€‚</p>
<p>ç±»å‹è½¬æ¢æ˜¯å°†ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹çš„ä¸€ç§æ›´å‹å¥½çš„æ–¹å¼: å®ƒä»¬ä¿ç•™æŠ½è±¡çš„<em>å€¼</em>ï¼Œ ä¸”ä¸ä¸€å®šæŒ‰ç…§<em>ä½æ¨¡å¼</em>è½¬æ¢ã€‚å¦‚æœæ— æ³•è¿›è¡Œè½¬æ¢ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™æˆ–å¼•å‘å¼‚å¸¸ã€‚</p>
<p>ç±»å‹è½¬æ¢çš„è¯­æ³•æ˜¯ <tt class="docutils literal"><span class="pre"><span class="Identifier">destination_type</span><span class="Punctuation">(</span><span class="Identifier">expression_to_convert</span><span class="Punctuation">)</span></span></tt> (ç±»ä¼¼æ™®é€šçš„è°ƒç”¨):</p>
<p><pre class="listing">
<span class="Keyword">proc</span> <span class="Identifier">getID</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">Person</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Operator">=</span>
  <span class="Identifier">Student</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span><span class="Operator">.</span><span class="Identifier">id</span></pre></p>
<p>å¦‚æœ <tt class="docutils literal"><span class="pre"><span class="Identifier">x</span></span></tt> ä¸æ˜¯ <tt class="docutils literal"><span class="pre"><span class="Identifier">Student</span></span></tt>ï¼Œåˆ™ä¼šå¼•å‘ <tt class="docutils literal"><span class="pre"><span class="Identifier">InvalidObjectConversionDefect</span></span></tt> å¼‚å¸¸ã€‚</p>

<h2><a class="toc-backref" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-å¯¹è±¡å˜ä½“" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-å¯¹è±¡å˜ä½“">å¯¹è±¡å˜ä½“</a></h2><p>ä½¿ç”¨é‰´åˆ«å™¨æ¥å¤„ç†ç®€å•çš„å¯¹è±¡å˜ä½“æ˜¯æå…¶é«˜æ•ˆçš„ã€‚</p>
<p>ä¾‹:</p>
<p><pre class="listing">
<span class="Comment"># This is an example how an abstract syntax tree could be modelled in Nim</span>
<span class="Keyword">type</span>
  <span class="Identifier">NodeKind</span> <span class="Operator">=</span> <span class="Keyword">enum</span>  <span class="Comment"># the different node types</span>
    <span class="Identifier">nkInt</span><span class="Punctuation">,</span>          <span class="Comment"># a leaf with an integer value</span>
    <span class="Identifier">nkFloat</span><span class="Punctuation">,</span>        <span class="Comment"># a leaf with a float value</span>
    <span class="Identifier">nkString</span><span class="Punctuation">,</span>       <span class="Comment"># a leaf with a string value</span>
    <span class="Identifier">nkAdd</span><span class="Punctuation">,</span>          <span class="Comment"># an addition</span>
    <span class="Identifier">nkSub</span><span class="Punctuation">,</span>          <span class="Comment"># a subtraction</span>
    <span class="Identifier">nkIf</span>            <span class="Comment"># an if statement</span>
  <span class="Identifier">Node</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span>
    <span class="Keyword">case</span> <span class="Identifier">kind</span><span class="Punctuation">:</span> <span class="Identifier">NodeKind</span>  <span class="Comment"># the `kind` field is the discriminator</span>
    <span class="Keyword">of</span> <span class="Identifier">nkInt</span><span class="Punctuation">:</span> <span class="Identifier">intVal</span><span class="Punctuation">:</span> <span class="Identifier">int</span>
    <span class="Keyword">of</span> <span class="Identifier">nkFloat</span><span class="Punctuation">:</span> <span class="Identifier">floatVal</span><span class="Punctuation">:</span> <span class="Identifier">float</span>
    <span class="Keyword">of</span> <span class="Identifier">nkString</span><span class="Punctuation">:</span> <span class="Identifier">strVal</span><span class="Punctuation">:</span> <span class="Identifier">string</span>
    <span class="Keyword">of</span> <span class="Identifier">nkAdd</span><span class="Punctuation">,</span> <span class="Identifier">nkSub</span><span class="Punctuation">:</span>
      <span class="Identifier">leftOp</span><span class="Punctuation">,</span> <span class="Identifier">rightOp</span><span class="Punctuation">:</span> <span class="Identifier">Node</span>
    <span class="Keyword">of</span> <span class="Identifier">nkIf</span><span class="Punctuation">:</span>
      <span class="Identifier">condition</span><span class="Punctuation">,</span> <span class="Identifier">thenPart</span><span class="Punctuation">,</span> <span class="Identifier">elsePart</span><span class="Punctuation">:</span> <span class="Identifier">Node</span>

<span class="Keyword">var</span> <span class="Identifier">n</span> <span class="Operator">=</span> <span class="Identifier">Node</span><span class="Punctuation">(</span><span class="Identifier">kind</span><span class="Punctuation">:</span> <span class="Identifier">nkFloat</span><span class="Punctuation">,</span> <span class="Identifier">floatVal</span><span class="Punctuation">:</span> <span class="FloatNumber">1.0</span><span class="Punctuation">)</span>
<span class="Comment"># the following statement raises an `FieldDefect` exception, because</span>
<span class="Comment"># n.kind's value does not fit:</span>
<span class="Identifier">n</span><span class="Operator">.</span><span class="Identifier">strVal</span> <span class="Operator">=</span> <span class="StringLit">&quot;&quot;</span></pre></p>
<p>ä»ç¤ºä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨é‰´åˆ«å™¨å¤„ç†å¼‚æ„å¯¹è±¡çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯æ— éœ€åœ¨ä¸åŒå¯¹è±¡ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ ç„¶è€Œï¼Œå¯¹æ— æ•ˆå¯¹è±¡å­—æ®µçš„è®¿é—®ä¼šå¼•å‘å¼‚å¸¸ã€‚</p>

<h2><a class="toc-backref" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-æ–¹æ³•è°ƒç”¨è¯­æ³•" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-æ–¹æ³•è°ƒç”¨è¯­æ³•">æ–¹æ³•è°ƒç”¨è¯­æ³•</a></h2><p>è°ƒç”¨ä¾‹ç¨‹æœ‰ä¸€ä¸ªè¯­æ³•ç³–: å¯ç”¨ <tt class="docutils literal"><span class="pre"><span class="Identifier">obj</span><span class="Operator">.</span><span class="Identifier">methodName</span><span class="Punctuation">(</span><span class="Identifier">args</span><span class="Punctuation">)</span></span></tt> è¯­æ³• ä»£æ›¿ <tt class="docutils literal"><span class="pre"><span class="Identifier">methodName</span><span class="Punctuation">(</span><span class="Identifier">obj</span><span class="Punctuation">,</span> <span class="Identifier">args</span><span class="Punctuation">)</span></span></tt>ã€‚å¦‚æœæ²¡æœ‰å…¶ä»–å‚æ•°ï¼Œå¯çœç•¥æ‹¬å·: <tt class="docutils literal"><span class="pre"><span class="Identifier">obj</span><span class="Operator">.</span><span class="Identifier">len</span></span></tt> (è€Œé <tt class="docutils literal"><span class="pre"><span class="Identifier">len</span><span class="Punctuation">(</span><span class="Identifier">obj</span><span class="Punctuation">)</span></span></tt>)ã€‚</p>
<p>è¿™ç§æ–¹æ³•è°ƒç”¨è¯­æ³•ä¸é™äºå¯¹è±¡ï¼Œå®ƒå¯ç”¨äºä»»ä½•ç±»å‹:</p>
<p><pre class="listing">
<span class="Keyword">import</span> <span class="Identifier">std</span><span class="Operator">/</span><span class="Identifier">strutils</span>

<span class="Identifier">echo</span> <span class="StringLit">&quot;abc&quot;</span><span class="Operator">.</span><span class="Identifier">len</span> <span class="Comment"># is the same as echo len(&quot;abc&quot;)</span>
<span class="Identifier">echo</span> <span class="StringLit">&quot;abc&quot;</span><span class="Operator">.</span><span class="Identifier">toUpperAscii</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Identifier">echo</span><span class="Punctuation">(</span><span class="Punctuation">{</span><span class="CharLit">'a'</span><span class="Punctuation">,</span> <span class="CharLit">'b'</span><span class="Punctuation">,</span> <span class="CharLit">'c'</span><span class="Punctuation">}</span><span class="Operator">.</span><span class="Identifier">card</span><span class="Punctuation">)</span>
<span class="Identifier">stdout</span><span class="Operator">.</span><span class="Identifier">writeLine</span><span class="Punctuation">(</span><span class="StringLit">&quot;Hallo&quot;</span><span class="Punctuation">)</span> <span class="Comment"># the same as writeLine(stdout, &quot;Hallo&quot;)</span></pre></p>
<p>(ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹ï¼Œæ–¹æ³•è°ƒç”¨çš„è¯­æ³•ï¼Œæä¾›äº†è¯­ä¹‰ä¸Šç¼ºçœçš„åç¼€)</p>
<p>æ‰€ä»¥&quot;çº¯é¢å‘å¯¹è±¡&quot;çš„ä»£ç å¾ˆå®¹æ˜“ç¼–å†™:</p>
<p><pre class="listing">
<span class="Keyword">import</span> <span class="Identifier">std</span><span class="Operator">/</span><span class="Punctuation">[</span><span class="Identifier">strutils</span><span class="Punctuation">,</span> <span class="Identifier">sequtils</span><span class="Punctuation">]</span>

<span class="Identifier">stdout</span><span class="Operator">.</span><span class="Identifier">writeLine</span><span class="Punctuation">(</span><span class="StringLit">&quot;Give a list of numbers (separated by spaces): &quot;</span><span class="Punctuation">)</span>
<span class="Identifier">stdout</span><span class="Operator">.</span><span class="Identifier">write</span><span class="Punctuation">(</span><span class="Identifier">stdin</span><span class="Operator">.</span><span class="Identifier">readLine</span><span class="Operator">.</span><span class="Identifier">splitWhitespace</span><span class="Operator">.</span><span class="Identifier">map</span><span class="Punctuation">(</span><span class="Identifier">parseInt</span><span class="Punctuation">)</span><span class="Operator">.</span><span class="Identifier">max</span><span class="Operator">.</span><span class="Punctuation">`</span><span class="Operator">$</span><span class="Punctuation">`</span><span class="Punctuation">)</span>
<span class="Identifier">stdout</span><span class="Operator">.</span><span class="Identifier">writeLine</span><span class="Punctuation">(</span><span class="StringLit">&quot; is the maximum!&quot;</span><span class="Punctuation">)</span></pre></p>

<h2><a class="toc-backref" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-å±æ€§" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-å±æ€§">å±æ€§</a></h2><p>å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼ŒNim ä¸éœ€è¦ <em>get-properties</em>: ä½¿ç”¨<em>æ–¹æ³•è°ƒç”¨è¯­æ³•</em>è°ƒç”¨çš„æ™®é€š get-procedures ä¸å‰è€…å®ç°ç›¸åŒã€‚ä½†è®¾ç½®ä¸€ä¸ªå€¼çš„æƒ…å†µå¹¶ä¸æ˜¯è¿™æ ·; ä¸ºæ­¤ï¼Œéœ€è¦ç‰¹æ®Šçš„ setter è¯­æ³•:</p>
<p><pre class="listing">
<span class="Keyword">type</span>
  <span class="Identifier">Socket</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">RootObj</span>
    <span class="Identifier">h</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Comment"># cannot be accessed from the outside of the module due to missing star</span>

<span class="Keyword">proc</span> <span class="Punctuation">`</span><span class="Identifier">host</span><span class="Operator">=</span><span class="Punctuation">`</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">s</span><span class="Punctuation">:</span> <span class="Keyword">var</span> <span class="Identifier">Socket</span><span class="Punctuation">,</span> <span class="Identifier">value</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Comment">## setter of host address</span>
  <span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">h</span> <span class="Operator">=</span> <span class="Identifier">value</span>

<span class="Keyword">proc</span> <span class="Identifier">host</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">s</span><span class="Punctuation">:</span> <span class="Identifier">Socket</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Comment">## getter of host address</span>
  <span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">h</span>

<span class="Keyword">var</span> <span class="Identifier">s</span><span class="Punctuation">:</span> <span class="Identifier">Socket</span>
<span class="Identifier">new</span> <span class="Identifier">s</span>
<span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">host</span> <span class="Operator">=</span> <span class="DecNumber">34</span>  <span class="Comment"># same as `host=`(s, 34)</span></pre></p>
<p>(è¯¥ç¤ºä¾‹è¿˜æ˜¾ç¤ºäº† <tt class="docutils literal"><span class="pre"><span class="Identifier">inline</span></span></tt> è¿‡ç¨‹)</p>
<p>æ•°ç»„è®¿é—®è¿ç®—ç¬¦ <tt class="docutils literal"><span class="pre"><span class="Punctuation">[</span><span class="Punctuation">]</span></span></tt> å¯è¢«é‡è½½ä»¥æä¾› <span id="array-properties_1">array properties</span>:</p>
<p><pre class="listing">
<span class="Keyword">type</span>
  <span class="Identifier">Vector</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="Keyword">object</span>
    <span class="Identifier">x</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">,</span> <span class="Identifier">z</span><span class="Punctuation">:</span> <span class="Identifier">float</span>

<span class="Keyword">proc</span> <span class="Punctuation">`</span><span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Operator">=</span><span class="Punctuation">`</span><span class="Operator">*</span> <span class="Punctuation">(</span><span class="Identifier">v</span><span class="Punctuation">:</span> <span class="Keyword">var</span> <span class="Identifier">Vector</span><span class="Punctuation">,</span> <span class="Identifier">i</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">,</span> <span class="Identifier">value</span><span class="Punctuation">:</span> <span class="Identifier">float</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Comment"># setter</span>
  <span class="Keyword">case</span> <span class="Identifier">i</span>
  <span class="Keyword">of</span> <span class="DecNumber">0</span><span class="Punctuation">:</span> <span class="Identifier">v</span><span class="Operator">.</span><span class="Identifier">x</span> <span class="Operator">=</span> <span class="Identifier">value</span>
  <span class="Keyword">of</span> <span class="DecNumber">1</span><span class="Punctuation">:</span> <span class="Identifier">v</span><span class="Operator">.</span><span class="Identifier">y</span> <span class="Operator">=</span> <span class="Identifier">value</span>
  <span class="Keyword">of</span> <span class="DecNumber">2</span><span class="Punctuation">:</span> <span class="Identifier">v</span><span class="Operator">.</span><span class="Identifier">z</span> <span class="Operator">=</span> <span class="Identifier">value</span>
  <span class="Keyword">else</span><span class="Punctuation">:</span> <span class="Identifier">assert</span><span class="Punctuation">(</span><span class="Identifier">false</span><span class="Punctuation">)</span>

<span class="Keyword">proc</span> <span class="Punctuation">`</span><span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Punctuation">`</span><span class="Operator">*</span> <span class="Punctuation">(</span><span class="Identifier">v</span><span class="Punctuation">:</span> <span class="Identifier">Vector</span><span class="Punctuation">,</span> <span class="Identifier">i</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">float</span> <span class="Operator">=</span>
  <span class="Comment"># getter</span>
  <span class="Keyword">case</span> <span class="Identifier">i</span>
  <span class="Keyword">of</span> <span class="DecNumber">0</span><span class="Punctuation">:</span> <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">v</span><span class="Operator">.</span><span class="Identifier">x</span>
  <span class="Keyword">of</span> <span class="DecNumber">1</span><span class="Punctuation">:</span> <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">v</span><span class="Operator">.</span><span class="Identifier">y</span>
  <span class="Keyword">of</span> <span class="DecNumber">2</span><span class="Punctuation">:</span> <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">v</span><span class="Operator">.</span><span class="Identifier">z</span>
  <span class="Keyword">else</span><span class="Punctuation">:</span> <span class="Identifier">assert</span><span class="Punctuation">(</span><span class="Identifier">false</span><span class="Punctuation">)</span></pre></p>
<p>è¿™ä¸ªä¾‹å­å¾ˆè ¢ï¼Œå› ä¸ºå‘é‡æœ€å¥½ç”±ä¸€ä¸ªæä¾›äº† <tt class="docutils literal"><span class="pre"><span class="Identifier">v</span><span class="Punctuation">[</span><span class="Punctuation">]</span></span></tt> è®¿é—®æ–¹å¼çš„å…ƒç»„æ¥æ„å»ºã€‚</p>

<h2><a class="toc-backref" id="é¢å‘å¯¹è±¡ç¼–ç¨‹-åŠ¨æ€åˆ†å‘" href="#é¢å‘å¯¹è±¡ç¼–ç¨‹-åŠ¨æ€åˆ†å‘">åŠ¨æ€åˆ†å‘</a></h2><p>è¿‡ç¨‹æ€»æ˜¯ä½¿ç”¨é™æ€åˆ†å‘ã€‚å¯¹äºåŠ¨æ€åˆ†å‘ï¼Œåº”ç”¨ <tt class="docutils literal"><span class="pre"><span class="Keyword">method</span></span></tt> æ›¿æ¢ <tt class="docutils literal"><span class="pre"><span class="Keyword">proc</span></span></tt> å…³é”®å­—:</p>
<p><pre class="listing">
<span class="Keyword">type</span>
  <span class="Identifier">Expression</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">RootObj</span> <span class="Comment">## abstract base class for an expression</span>
  <span class="Identifier">Literal</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Expression</span>
    <span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">int</span>
  <span class="Identifier">PlusExpr</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Expression</span>
    <span class="Identifier">a</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">:</span> <span class="Identifier">Expression</span>

<span class="Comment"># watch out: 'eval' relies on dynamic binding</span>
<span class="Keyword">method</span> <span class="Identifier">eval</span><span class="Punctuation">(</span><span class="Identifier">e</span><span class="Punctuation">:</span> <span class="Identifier">Expression</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">base</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Comment"># override this base method</span>
  <span class="Identifier">quit</span> <span class="StringLit">&quot;to override!&quot;</span>

<span class="Keyword">method</span> <span class="Identifier">eval</span><span class="Punctuation">(</span><span class="Identifier">e</span><span class="Punctuation">:</span> <span class="Identifier">Literal</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Operator">=</span> <span class="Identifier">e</span><span class="Operator">.</span><span class="Identifier">x</span>
<span class="Keyword">method</span> <span class="Identifier">eval</span><span class="Punctuation">(</span><span class="Identifier">e</span><span class="Punctuation">:</span> <span class="Identifier">PlusExpr</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Operator">=</span> <span class="Identifier">eval</span><span class="Punctuation">(</span><span class="Identifier">e</span><span class="Operator">.</span><span class="Identifier">a</span><span class="Punctuation">)</span> <span class="Operator">+</span> <span class="Identifier">eval</span><span class="Punctuation">(</span><span class="Identifier">e</span><span class="Operator">.</span><span class="Identifier">b</span><span class="Punctuation">)</span>

<span class="Keyword">proc</span> <span class="Identifier">newLit</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Literal</span> <span class="Operator">=</span> <span class="Identifier">Literal</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">x</span><span class="Punctuation">)</span>
<span class="Keyword">proc</span> <span class="Identifier">newPlus</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">:</span> <span class="Identifier">Expression</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">PlusExpr</span> <span class="Operator">=</span> <span class="Identifier">PlusExpr</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">a</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">:</span> <span class="Identifier">b</span><span class="Punctuation">)</span>

<span class="Identifier">echo</span> <span class="Identifier">eval</span><span class="Punctuation">(</span><span class="Identifier">newPlus</span><span class="Punctuation">(</span><span class="Identifier">newPlus</span><span class="Punctuation">(</span><span class="Identifier">newLit</span><span class="Punctuation">(</span><span class="DecNumber">1</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="Identifier">newLit</span><span class="Punctuation">(</span><span class="DecNumber">2</span><span class="Punctuation">)</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="Identifier">newLit</span><span class="Punctuation">(</span><span class="DecNumber">4</span><span class="Punctuation">)</span><span class="Punctuation">)</span><span class="Punctuation">)</span></pre></p>
<p>è¯·æ³¨æ„ï¼Œåœ¨ç¤ºä¾‹ä¸­ï¼Œæ„é€ å‡½æ•° <tt class="docutils literal"><span class="pre"><span class="Identifier">newLit</span></span></tt> å’Œ <tt class="docutils literal"><span class="pre"><span class="Identifier">newPlus</span></span></tt> æ˜¯è¿‡ç¨‹ï¼Œ å› ä¸ºå®ƒä»¬ä½¿ç”¨é™æ€ç»‘å®šæ›´æœ‰æ„ä¹‰ï¼Œä½† <tt class="docutils literal"><span class="pre"><span class="Identifier">eval</span></span></tt> æ˜¯ä¸€ç§æ–¹æ³•ï¼Œå› ä¸ºå®ƒéœ€è¦åŠ¨æ€ç»‘å®šã€‚</p>
<p><strong>æ³¨æ„:</strong> ä» Nim 0.20 å¼€å§‹ï¼Œè¦ä½¿ç”¨ multi-methodsï¼Œå¿…é¡»åœ¨ç¼–è¯‘æ—¶æ˜¾å¼ä¼ é€’ <tt class="docutils literal"><span class="pre">--multimethods:on</span></tt>ã€‚</p>
<p>åœ¨ multi-methods ä¸­ï¼Œæ‰€æœ‰å…·æœ‰å¯¹è±¡ç±»å‹çš„å‚æ•°éƒ½å°†ç”¨äºåˆ†å‘:</p>
<p><pre class="listing">
<span class="Keyword">type</span>
  <span class="Identifier">Thing</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">RootObj</span>
  <span class="Identifier">Unit</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Thing</span>
    <span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">int</span>

<span class="Keyword">method</span> <span class="Identifier">collide</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">:</span> <span class="Identifier">Thing</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Identifier">quit</span> <span class="StringLit">&quot;to override!&quot;</span>

<span class="Keyword">method</span> <span class="Identifier">collide</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">Thing</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">:</span> <span class="Identifier">Unit</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;1&quot;</span>

<span class="Keyword">method</span> <span class="Identifier">collide</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">Unit</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">:</span> <span class="Identifier">Thing</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;2&quot;</span>

<span class="Keyword">var</span> <span class="Identifier">a</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">:</span> <span class="Identifier">Unit</span>
<span class="Identifier">new</span> <span class="Identifier">a</span>
<span class="Identifier">new</span> <span class="Identifier">b</span>
<span class="Identifier">collide</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">)</span> <span class="Comment"># output: 2</span></pre></p>
<p>å¦‚ç¤ºä¾‹æ‰€ç¤ºï¼Œå¯¹ multi-method çš„è°ƒç”¨ä¸èƒ½æ¨¡æ£±ä¸¤å¯: collide 2 ä¼˜äº collide 1ï¼Œ å› ä¸ºè§£ææ·±åº¦ä»å·¦åˆ°å³é™ä½ã€‚å› æ­¤ï¼Œ<tt class="docutils literal"><span class="pre"><span class="Identifier">Unit</span><span class="Punctuation">,</span> <span class="Identifier">Thing</span></span></tt> ä¼˜äº <tt class="docutils literal"><span class="pre"><span class="Identifier">Thing</span><span class="Punctuation">,</span> <span class="Identifier">Unit</span></span></tt>ã€‚</p>
<p><strong>æ€§èƒ½è¯´æ˜</strong>: Nim ä¸ç”Ÿæˆè™šæ‹Ÿæ–¹æ³•è¡¨ï¼Œè€Œæ˜¯ç”Ÿæˆè°ƒåº¦æ ‘ã€‚è¿™é¿å…äº†æ–¹æ³•è°ƒç”¨æ˜‚è´µçš„é—´æ¥åˆ†æ”¯å¹¶æ”¯æŒå†…è”ã€‚ ä½†æ˜¯ï¼Œç¼–è¯‘æ—¶è¯„ä¼°ä»¥åŠæ­»ä»£ç æ¶ˆé™¤ç­‰å…¶ä»–ä¼˜åŒ–å°†ä¸é€‚ç”¨äºæ–¹æ³•ã€‚</p>

<h1><a class="toc-backref" id="å¼‚å¸¸" href="#å¼‚å¸¸">å¼‚å¸¸</a></h1><p>åœ¨ Nim ä¸­ï¼Œå¼‚å¸¸æ˜¯å¯¹è±¡ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œå¼‚å¸¸ç±»å‹ä»¥ 'Error' ä¸ºåç¼€ã€‚ <a class="reference external" href="system.html">system</a> æ¨¡å—å®šä¹‰äº†ä½ å¯èƒ½æƒ³è¦ä¾ç…§çš„å¼‚å¸¸å±‚æ¬¡ç»“æ„ã€‚ å¼‚å¸¸ä»æä¾›äº†å…¬å…±æ¥å£çš„<tt class="docutils literal"><span class="pre"><span class="Identifier">system</span><span class="Operator">.</span><span class="Identifier">Exception</span></span></tt>æ´¾ç”Ÿã€‚</p>
<p>å¼‚å¸¸å¿…é¡»åœ¨å †ä¸Šåˆ†é…ï¼Œå› ä¸ºå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æœªçŸ¥çš„ã€‚ç¼–è¯‘å™¨å°†é˜»æ­¢ä½ å¼•å‘åœ¨æ ˆä¸Šåˆ›å»ºçš„å¼‚å¸¸ã€‚ æ‰€æœ‰å¼•å‘çš„å¼‚å¸¸è‡³å°‘åº”åœ¨ <tt class="docutils literal"><span class="pre"><span class="Identifier">msg</span></span></tt> å­—æ®µä¸­æŒ‡å®šå¼•å‘çš„åŸå› ã€‚</p>
<p>å¼‚å¸¸åº”åœ¨<em>å‘ç”Ÿå¼‚å¸¸</em>çš„æƒ…å†µä¸‹å¼•å‘ï¼Œå®ƒä»¬ä¸åº”ç”¨ä½œæ§åˆ¶æµçš„æ›¿ä»£æ–¹æ³•ã€‚</p>

<h2><a class="toc-backref" id="å¼‚å¸¸-raise-è¯­å¥" href="#å¼‚å¸¸-raise-è¯­å¥">Raise è¯­å¥</a></h2><p>å¼•å‘å¼‚å¸¸æ˜¯é€šè¿‡ <tt class="docutils literal"><span class="pre"><span class="Keyword">raise</span></span></tt> è¯­å¥å®Œæˆçš„:</p>
<p><pre class="listing">
<span class="Keyword">var</span>
  <span class="Identifier">e</span><span class="Punctuation">:</span> <span class="Keyword">ref</span> <span class="Identifier">OSError</span>
<span class="Identifier">new</span><span class="Punctuation">(</span><span class="Identifier">e</span><span class="Punctuation">)</span>
<span class="Identifier">e</span><span class="Operator">.</span><span class="Identifier">msg</span> <span class="Operator">=</span> <span class="StringLit">&quot;the request to the OS failed&quot;</span>
<span class="Keyword">raise</span> <span class="Identifier">e</span></pre></p>
<p>å¦‚æœ <tt class="docutils literal"><span class="pre"><span class="Keyword">raise</span></span></tt> å…³é”®å­—åé¢æ²¡æœ‰è·Ÿè¡¨è¾¾å¼ï¼Œæœ€åä¸€ä¸ªå¼‚å¸¸å°†è¢«<em>å†æ¬¡å¼•å‘</em>ã€‚ ä¸ºé¿å…é‡å¤è¿™ç§å¸¸è§çš„ä»£ç æ¨¡å¼ï¼Œå¯ç”¨ <tt class="docutils literal"><span class="pre"><span class="Identifier">system</span></span></tt> æ¨¡å—ä¸­çš„æ¨¡æ¿ <tt class="docutils literal"><span class="pre"><span class="Identifier">newException</span></span></tt>:</p>
<p><pre class="listing">
<span class="Keyword">raise</span> <span class="Identifier">newException</span><span class="Punctuation">(</span><span class="Identifier">OSError</span><span class="Punctuation">,</span> <span class="StringLit">&quot;the request to the OS failed&quot;</span><span class="Punctuation">)</span></pre></p>

<h2><a class="toc-backref" id="å¼‚å¸¸-try-è¯­å¥" href="#å¼‚å¸¸-try-è¯­å¥">Try è¯­å¥</a></h2><p><tt class="docutils literal"><span class="pre"><span class="Keyword">try</span></span></tt> è¯­å¥å¤„ç†å¼‚å¸¸:</p>
<p><pre class="listing">
<span class="Keyword">from</span> <span class="Identifier">std</span><span class="Operator">/</span><span class="Identifier">strutils</span> <span class="Keyword">import</span> <span class="Identifier">parseInt</span>

<span class="Comment"># read the first two lines of a text file that should contain numbers</span>
<span class="Comment"># and tries to add them</span>
<span class="Keyword">var</span>
  <span class="Identifier">f</span><span class="Punctuation">:</span> <span class="Identifier">File</span>
<span class="Keyword">if</span> <span class="Identifier">open</span><span class="Punctuation">(</span><span class="Identifier">f</span><span class="Punctuation">,</span> <span class="StringLit">&quot;numbers.txt&quot;</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Keyword">try</span><span class="Punctuation">:</span>
    <span class="Keyword">let</span> <span class="Identifier">a</span> <span class="Operator">=</span> <span class="Identifier">readLine</span><span class="Punctuation">(</span><span class="Identifier">f</span><span class="Punctuation">)</span>
    <span class="Keyword">let</span> <span class="Identifier">b</span> <span class="Operator">=</span> <span class="Identifier">readLine</span><span class="Punctuation">(</span><span class="Identifier">f</span><span class="Punctuation">)</span>
    <span class="Identifier">echo</span> <span class="StringLit">&quot;sum: &quot;</span><span class="Punctuation">,</span> <span class="Identifier">parseInt</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">)</span> <span class="Operator">+</span> <span class="Identifier">parseInt</span><span class="Punctuation">(</span><span class="Identifier">b</span><span class="Punctuation">)</span>
  <span class="Keyword">except</span> <span class="Identifier">OverflowDefect</span><span class="Punctuation">:</span>
    <span class="Identifier">echo</span> <span class="StringLit">&quot;overflow!&quot;</span>
  <span class="Keyword">except</span> <span class="Identifier">ValueError</span><span class="Punctuation">:</span>
    <span class="Identifier">echo</span> <span class="StringLit">&quot;could not convert string to integer&quot;</span>
  <span class="Keyword">except</span> <span class="Identifier">IOError</span><span class="Punctuation">:</span>
    <span class="Identifier">echo</span> <span class="StringLit">&quot;IO error!&quot;</span>
  <span class="Keyword">except</span><span class="Punctuation">:</span>
    <span class="Identifier">echo</span> <span class="StringLit">&quot;Unknown exception!&quot;</span>
    <span class="Comment"># reraise the unknown exception:</span>
    <span class="Keyword">raise</span>
  <span class="Keyword">finally</span><span class="Punctuation">:</span>
    <span class="Identifier">close</span><span class="Punctuation">(</span><span class="Identifier">f</span><span class="Punctuation">)</span></pre></p>
<p>é™¤éæœ‰å¼‚å¸¸è¢«å¼•å‘ï¼Œå¦åˆ™å°†æ‰§è¡Œ <tt class="docutils literal"><span class="pre"><span class="Keyword">try</span></span></tt> ä¹‹åçš„è¯­å¥ã€‚ç„¶åæ‰§è¡Œä¹‹åå¯èƒ½è¾¾åˆ°çš„ <tt class="docutils literal"><span class="pre"><span class="Keyword">except</span></span></tt> éƒ¨åˆ†ã€‚</p>
<p>å¦‚æœå­˜åœ¨æœªæ˜ç¡®åˆ—å‡ºçš„å¼‚å¸¸ï¼Œåˆ™æ‰§è¡Œç©ºçš„ <tt class="docutils literal"><span class="pre"><span class="Keyword">except</span></span></tt> éƒ¨åˆ†ã€‚å®ƒç±»ä¼¼äº <tt class="docutils literal"><span class="pre"><span class="Keyword">if</span></span></tt> è¯­å¥ä¸­çš„ <tt class="docutils literal"><span class="pre"><span class="Keyword">else</span></span></tt>ã€‚</p>
<p>è‹¥æœ‰ <tt class="docutils literal"><span class="pre"><span class="Keyword">finally</span></span></tt> éƒ¨åˆ†ï¼Œå®ƒæ€»æ˜¯åœ¨å¼‚å¸¸å¤„ç†ä¹‹åæ‰§è¡Œã€‚</p>
<p>å¼‚å¸¸åœ¨ <tt class="docutils literal"><span class="pre"><span class="Keyword">except</span></span></tt> éƒ¨åˆ†è¢«<em>æ¶ˆè´¹</em>ã€‚å¦‚æœå¼‚å¸¸æœªè¢«å¤„ç†ï¼Œåˆ™å…¶é€šè¿‡è°ƒç”¨å †æ ˆä¼ æ’­ã€‚ è¿™æ„å‘³ç€å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œç¨‹åºçš„å…¶ä½™éƒ¨åˆ†â€”â€”ä¸åœ¨ <tt class="docutils literal"><span class="pre"><span class="Keyword">finally</span></span></tt> å­å¥ä¸­â€”â€”é€šå¸¸ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>
<p>å¦‚æœä½ éœ€è¦<em>è®¿é—®</em> <tt class="docutils literal"><span class="pre"><span class="Keyword">except</span></span></tt> åˆ†æ”¯ä¸­çš„å®é™…å¼‚å¸¸å¯¹è±¡æˆ–æ¶ˆæ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨[ç³»ç»Ÿ](system.htmlï¼‰æ¨¡å—ä¸­çš„ <a class="reference external" href="system.html#getCurrentException">getCurrentException()</a> å’Œ <a class="reference external" href=" system.html#getCurrentExceptionMsg">getCurrentExceptionMsg()</a> è¿‡ç¨‹ã€‚ä¾‹å¦‚:</p>
<p><pre class="listing">
<span class="Keyword">try</span><span class="Punctuation">:</span>
  <span class="Identifier">doSomethingHere</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">except</span><span class="Punctuation">:</span>
  <span class="Keyword">let</span>
    <span class="Identifier">e</span> <span class="Operator">=</span> <span class="Identifier">getCurrentException</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
    <span class="Identifier">msg</span> <span class="Operator">=</span> <span class="Identifier">getCurrentExceptionMsg</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;Got exception &quot;</span><span class="Punctuation">,</span> <span class="Identifier">repr</span><span class="Punctuation">(</span><span class="Identifier">e</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="StringLit">&quot; with message &quot;</span><span class="Punctuation">,</span> <span class="Identifier">msg</span></pre></p>

<h2><a class="toc-backref" id="å¼‚å¸¸-ç”¨-raised-exceptions-æ³¨è§£è¿‡ç¨‹" href="#å¼‚å¸¸-ç”¨-raised-exceptions-æ³¨è§£è¿‡ç¨‹">ç”¨ raised exceptions æ³¨è§£è¿‡ç¨‹</a></h2><p>é€šè¿‡ä½¿ç”¨å¯é€‰çš„ <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">raises</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> ç¼–è¯‘æŒ‡ç¤ºï¼Œä½ å¯æŒ‡å®šè¿‡ç¨‹æ—¨åœ¨å¼•å‘ä¸€ç»„ç‰¹å®šçš„å¼‚å¸¸ï¼Œæˆ–è€…æ ¹æœ¬ä¸å¼•å‘å¼‚å¸¸ã€‚ å¦‚æœä½¿ç”¨äº† <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">raises</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> ç¼–è¯‘æŒ‡ç¤ºï¼Œç¼–è¯‘å™¨å°†éªŒè¯è¿™æ˜¯å¦ä¸ºçœŸã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æŒ‡å®šè¿‡ç¨‹ä¼šå¼•å‘ <tt class="docutils literal"><span class="pre"><span class="Identifier">IOError</span></span></tt>ï¼Œ å¹¶ä¸”åœ¨æŸä¸ªæ—¶å€™å®ƒ(æˆ–å®ƒè°ƒç”¨çš„å…¶ä¸­ä¸€ä¸ªè¿‡ç¨‹)å¼€å§‹å¼•å‘æ–°å¼‚å¸¸ï¼Œåˆ™ç¼–è¯‘å™¨å°†é˜»æ­¢è¯¥è¿‡ç¨‹ç¼–è¯‘ã€‚ä½¿ç”¨ç¤ºä¾‹:</p>
<p><pre class="listing">
<span class="Keyword">proc</span> <span class="Identifier">complexProc</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">raises</span><span class="Punctuation">:</span> <span class="Punctuation">[</span><span class="Identifier">IOError</span><span class="Punctuation">,</span> <span class="Identifier">ArithmeticDefect</span><span class="Punctuation">]</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Operator">...</span>

<span class="Keyword">proc</span> <span class="Identifier">simpleProc</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">raises</span><span class="Punctuation">:</span> <span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Operator">...</span></pre></p>
<p>ä¸€æ—¦ä½ æœ‰äº†è¿™æ ·çš„ä»£ç ï¼Œå¦‚æœå¼•å‘çš„å¼‚å¸¸åˆ—è¡¨å‘ç”Ÿæ›´æ”¹ï¼Œç¼–è¯‘å™¨å°†åœæ­¢å¹¶æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ï¼ŒæŒ‡å®šåœæ­¢éªŒè¯ç¼–è¯‘æŒ‡ç¤º çš„è¿‡ç¨‹è¡Œå’Œæœªæ•è·çš„å¯å¼•å‘çš„å¼‚å¸¸ï¼Œä»¥åŠæœªæ•è·çš„å·²å¼•å‘å¼‚å¸¸æ‰€åœ¨çš„æ–‡ä»¶å’Œè¡Œï¼Œè¿™å¯å¸®åŠ©ä½ æ‰¾åˆ°å·²æ›´æ”¹çš„è¿è§„ä»£ç ã€‚</p>
<p>å¦‚æœä½ æƒ³å°† <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">raises</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> ç¼–è¯‘æŒ‡ç¤ºæ·»åŠ åˆ°ç°æœ‰ä»£ç ä¸­ï¼Œç¼–è¯‘å™¨ä¹Ÿå¯åŠ©ä½ ä¸€è‡‚ä¹‹åŠ›ã€‚ å°† <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">effects</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> ç¼–è¯‘æŒ‡ç¤ºè¯­å¥æ·»åŠ åˆ°ä½ çš„è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨å°†æŠŠæ‰€æœ‰çš„æ¨æ–­æ•ˆæœè¾“å‡ºåˆ°è¯¥ç‚¹ (å¼‚å¸¸è·Ÿè¸ªæ˜¯ Nim effect ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†)ã€‚å¦ä¸€ç§æŸ¥æ‰¾è¿‡ç¨‹å¼•å‘çš„å¼‚å¸¸åˆ—è¡¨çš„æ›´ä¸ºéšæ™¦çš„æ–¹æ³•æ˜¯ä½¿ç”¨ Nim <tt class="docutils literal"><span class="pre">doc</span></tt> å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¸ºæ•´ä¸ªæ¨¡å—ç”Ÿæˆæ–‡æ¡£ï¼Œå¹¶ç”¨å¼‚å¸¸å¼•å‘åˆ—è¡¨è£…é¥°æ‰€æœ‰è¿‡ç¨‹ã€‚ ä½ å¯<a class="reference external" href="manual.html#effect-system">åœ¨æ‰‹å†Œä¸­é˜…è¯»æ›´å¤šå…³äº Nim çš„ effect ç³»ç»Ÿå’Œç›¸å…³ç¼–è¯‘æŒ‡ç¤ºçš„ä¿¡æ¯</a>ã€‚</p>

<h1><a class="toc-backref" id="æ³›å‹" href="#æ³›å‹">æ³›å‹</a></h1><p>æ³›å‹æ˜¯ Nim ä½¿ç”¨ <span id="type-parameters_1">type parameters</span> å‚æ•°åŒ–è¿‡ç¨‹ã€è¿­ä»£å™¨æˆ–ç±»å‹çš„æ–¹æ³•ã€‚ æ³›å‹å‚æ•°å†™åœ¨æ–¹æ‹¬å·å†…ï¼Œä¾‹å¦‚ <tt class="docutils literal"><span class="pre"><span class="Identifier">Foo</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span></span></tt>ã€‚å®ƒä»¬å¯¹é«˜æ•ˆçš„ç±»å‹å®‰å…¨å®¹å™¨æœ€æœ‰ç”¨:</p>
<p><pre class="listing">
<span class="Keyword">type</span>
  <span class="Identifier">BinaryTree</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Comment"># BinaryTree is a generic type with</span>
                              <span class="Comment"># generic param `T`</span>
    <span class="Identifier">le</span><span class="Punctuation">,</span> <span class="Identifier">ri</span><span class="Punctuation">:</span> <span class="Identifier">BinaryTree</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span>     <span class="Comment"># left and right subtrees; may be nil</span>
    <span class="Identifier">data</span><span class="Punctuation">:</span> <span class="Identifier">T</span>                   <span class="Comment"># the data stored in a node</span>

<span class="Keyword">proc</span> <span class="Identifier">newNode</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">data</span><span class="Punctuation">:</span> <span class="Identifier">T</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">BinaryTree</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Operator">=</span>
  <span class="Comment"># constructor for a node</span>
  <span class="Identifier">new</span><span class="Punctuation">(</span><span class="Identifier">result</span><span class="Punctuation">)</span>
  <span class="Identifier">result</span><span class="Operator">.</span><span class="Identifier">data</span> <span class="Operator">=</span> <span class="Identifier">data</span>

<span class="Keyword">proc</span> <span class="Identifier">add</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">root</span><span class="Punctuation">:</span> <span class="Keyword">var</span> <span class="Identifier">BinaryTree</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">,</span> <span class="Identifier">n</span><span class="Punctuation">:</span> <span class="Identifier">BinaryTree</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Comment"># insert a node into the tree</span>
  <span class="Keyword">if</span> <span class="Identifier">root</span> <span class="Operator">==</span> <span class="Keyword">nil</span><span class="Punctuation">:</span>
    <span class="Identifier">root</span> <span class="Operator">=</span> <span class="Identifier">n</span>
  <span class="Keyword">else</span><span class="Punctuation">:</span>
    <span class="Keyword">var</span> <span class="Identifier">it</span> <span class="Operator">=</span> <span class="Identifier">root</span>
    <span class="Keyword">while</span> <span class="Identifier">it</span> <span class="Operator">!=</span> <span class="Keyword">nil</span><span class="Punctuation">:</span>
      <span class="Comment"># compare the data items; uses the generic `cmp` proc</span>
      <span class="Comment"># that works for any type that has a `==` and `&lt;` operator</span>
      <span class="Keyword">var</span> <span class="Identifier">c</span> <span class="Operator">=</span> <span class="Identifier">cmp</span><span class="Punctuation">(</span><span class="Identifier">it</span><span class="Operator">.</span><span class="Identifier">data</span><span class="Punctuation">,</span> <span class="Identifier">n</span><span class="Operator">.</span><span class="Identifier">data</span><span class="Punctuation">)</span>
      <span class="Keyword">if</span> <span class="Identifier">c</span> <span class="Operator">&lt;</span> <span class="DecNumber">0</span><span class="Punctuation">:</span>
        <span class="Keyword">if</span> <span class="Identifier">it</span><span class="Operator">.</span><span class="Identifier">le</span> <span class="Operator">==</span> <span class="Keyword">nil</span><span class="Punctuation">:</span>
          <span class="Identifier">it</span><span class="Operator">.</span><span class="Identifier">le</span> <span class="Operator">=</span> <span class="Identifier">n</span>
          <span class="Keyword">return</span>
        <span class="Identifier">it</span> <span class="Operator">=</span> <span class="Identifier">it</span><span class="Operator">.</span><span class="Identifier">le</span>
      <span class="Keyword">else</span><span class="Punctuation">:</span>
        <span class="Keyword">if</span> <span class="Identifier">it</span><span class="Operator">.</span><span class="Identifier">ri</span> <span class="Operator">==</span> <span class="Keyword">nil</span><span class="Punctuation">:</span>
          <span class="Identifier">it</span><span class="Operator">.</span><span class="Identifier">ri</span> <span class="Operator">=</span> <span class="Identifier">n</span>
          <span class="Keyword">return</span>
        <span class="Identifier">it</span> <span class="Operator">=</span> <span class="Identifier">it</span><span class="Operator">.</span><span class="Identifier">ri</span>

<span class="Keyword">proc</span> <span class="Identifier">add</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">root</span><span class="Punctuation">:</span> <span class="Keyword">var</span> <span class="Identifier">BinaryTree</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">,</span> <span class="Identifier">data</span><span class="Punctuation">:</span> <span class="Identifier">T</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Comment"># convenience proc:</span>
  <span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">root</span><span class="Punctuation">,</span> <span class="Identifier">newNode</span><span class="Punctuation">(</span><span class="Identifier">data</span><span class="Punctuation">)</span><span class="Punctuation">)</span>

<span class="Keyword">iterator</span> <span class="Identifier">preorder</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">root</span><span class="Punctuation">:</span> <span class="Identifier">BinaryTree</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">T</span> <span class="Operator">=</span>
  <span class="Comment"># Preorder traversal of a binary tree.</span>
  <span class="Comment"># This uses an explicit stack (which is more efficient than</span>
  <span class="Comment"># a recursive iterator factory).</span>
  <span class="Keyword">var</span> <span class="Identifier">stack</span><span class="Punctuation">:</span> <span class="Identifier">seq</span><span class="Punctuation">[</span><span class="Identifier">BinaryTree</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">root</span><span class="Punctuation">]</span>
  <span class="Keyword">while</span> <span class="Identifier">stack</span><span class="Operator">.</span><span class="Identifier">len</span> <span class="Operator">&gt;</span> <span class="DecNumber">0</span><span class="Punctuation">:</span>
    <span class="Keyword">var</span> <span class="Identifier">n</span> <span class="Operator">=</span> <span class="Identifier">stack</span><span class="Operator">.</span><span class="Identifier">pop</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
    <span class="Keyword">while</span> <span class="Identifier">n</span> <span class="Operator">!=</span> <span class="Keyword">nil</span><span class="Punctuation">:</span>
      <span class="Keyword">yield</span> <span class="Identifier">n</span><span class="Operator">.</span><span class="Identifier">data</span>
      <span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">stack</span><span class="Punctuation">,</span> <span class="Identifier">n</span><span class="Operator">.</span><span class="Identifier">ri</span><span class="Punctuation">)</span>  <span class="Comment"># push right subtree onto the stack</span>
      <span class="Identifier">n</span> <span class="Operator">=</span> <span class="Identifier">n</span><span class="Operator">.</span><span class="Identifier">le</span>          <span class="Comment"># and follow the left pointer</span>

<span class="Keyword">var</span>
  <span class="Identifier">root</span><span class="Punctuation">:</span> <span class="Identifier">BinaryTree</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">]</span> <span class="Comment"># instantiate a BinaryTree with `string`</span>
<span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">root</span><span class="Punctuation">,</span> <span class="Identifier">newNode</span><span class="Punctuation">(</span><span class="StringLit">&quot;hello&quot;</span><span class="Punctuation">)</span><span class="Punctuation">)</span> <span class="Comment"># instantiates `newNode` and `add`</span>
<span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">root</span><span class="Punctuation">,</span> <span class="StringLit">&quot;world&quot;</span><span class="Punctuation">)</span>          <span class="Comment"># instantiates the second `add` proc</span>
<span class="Keyword">for</span> <span class="Identifier">str</span> <span class="Keyword">in</span> <span class="Identifier">preorder</span><span class="Punctuation">(</span><span class="Identifier">root</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Identifier">stdout</span><span class="Operator">.</span><span class="Identifier">writeLine</span><span class="Punctuation">(</span><span class="Identifier">str</span><span class="Punctuation">)</span></pre></p>
<p>è¯¥ä¾‹å±•ç¤ºäº†ä¸€ä¸ªæ³›å‹äºŒå‰æ ‘ã€‚æ ¹æ®ä¸Šä¸‹æ–‡ï¼Œæ–¹æ‹¬å·å¯ç”¨äºå¼•å…¥ç±»å‹å‚æ•°æˆ–å®ä¾‹åŒ–æ³›å‹è¿‡ç¨‹ã€è¿­ä»£å™¨æˆ–ç±»å‹ã€‚ å¦‚ç¤ºä¾‹æ‰€ç¤ºï¼Œæ³›å‹æ”¯æŒé‡è½½: ä½¿ç”¨ <tt class="docutils literal"><span class="pre"><span class="Identifier">add</span></span></tt> çš„æœ€ä½³åŒ¹é…ã€‚åºåˆ—çš„å†…ç½® <tt class="docutils literal"><span class="pre"><span class="Identifier">add</span></span></tt> è¿‡ç¨‹ä¸æ˜¯éšè—çš„ï¼Œ å¹¶ä¸”åœ¨ <tt class="docutils literal"><span class="pre"><span class="Identifier">preorder</span></span></tt> è¿­ä»£å™¨ä¸­ä½¿ç”¨ã€‚</p>
<p>åœ¨æ–¹æ³•è°ƒç”¨è¯­æ³•ä¸­ä½¿ç”¨æ³›å‹æ—¶æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ <tt class="docutils literal"><span class="pre"><span class="Punctuation">[</span><span class="Punctuation">:</span><span class="Identifier">T</span><span class="Punctuation">]</span></span></tt> è¯­æ³•:</p>
<p><pre class="listing">
<span class="Keyword">proc</span> <span class="Identifier">foo</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">i</span><span class="Punctuation">:</span> <span class="Identifier">T</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Keyword">discard</span>

<span class="Keyword">var</span> <span class="Identifier">i</span><span class="Punctuation">:</span> <span class="Identifier">int</span>

<span class="Comment"># i.foo[int]() # Error: expression 'foo(i)' has no type (or is ambiguous)</span>

<span class="Identifier">i</span><span class="Operator">.</span><span class="Identifier">foo</span><span class="Punctuation">[</span><span class="Punctuation">:</span><span class="Identifier">int</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Comment"># Success</span></pre></p>

<h1><a class="toc-backref" id="æ¨¡æ¿" href="#æ¨¡æ¿">æ¨¡æ¿</a></h1><p>æ¨¡æ¿æ˜¯ä¸€ç§åœ¨ Nim æŠ½è±¡è¯­æ³•æ ‘ä¸Šæ‰§è¡Œçš„ç®€å•æ›¿æ¢æœºåˆ¶ã€‚æ¨¡æ¿åœ¨ç¼–è¯‘å™¨çš„è¯­ä¹‰ä¼ é€’ä¸­å¤„ç†ã€‚ å®ƒä»¬ä¸è¯­è¨€çš„å…¶ä½™éƒ¨åˆ†å¾ˆå¥½åœ°é›†æˆï¼Œä¸”æ²¡æœ‰ C çš„é¢„å¤„ç†å™¨å®çš„ç¼ºé™·ã€‚</p>
<p>è¦<em>è°ƒç”¨</em>æ¨¡æ¿ï¼Œè¯·åƒè°ƒç”¨è¿‡ç¨‹ä¸€æ ·è°ƒç”¨å®ƒã€‚</p>
<p>ä¾‹:</p>
<p><pre class="listing">
<span class="Keyword">template</span> <span class="Punctuation">`</span><span class="Operator">!=</span><span class="Punctuation">`</span> <span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">:</span> <span class="Identifier">untyped</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">untyped</span> <span class="Operator">=</span>
  <span class="Comment"># this definition exists in the System module</span>
  <span class="Keyword">not</span> <span class="Punctuation">(</span><span class="Identifier">a</span> <span class="Operator">==</span> <span class="Identifier">b</span><span class="Punctuation">)</span>

<span class="Identifier">assert</span><span class="Punctuation">(</span><span class="DecNumber">5</span> <span class="Operator">!=</span> <span class="DecNumber">6</span><span class="Punctuation">)</span> <span class="Comment"># the compiler rewrites that to: assert(not (5 == 6))</span></pre></p>
<p><tt class="docutils literal"><span class="pre"><span class="Operator">!=</span></span></tt>ã€<tt class="docutils literal"><span class="pre"><span class="Operator">&gt;</span></span></tt>ã€<tt class="docutils literal"><span class="pre"><span class="Operator">&gt;=</span></span></tt>ã€<tt class="docutils literal"><span class="pre"><span class="Keyword">in</span></span></tt>ã€<tt class="docutils literal"><span class="pre"><span class="Keyword">notin</span></span></tt>ã€<tt class="docutils literal"><span class="pre"><span class="Keyword">isnot</span></span></tt> è¿ç®—ç¬¦å®é™…ä¸Šæ˜¯æ¨¡æ¿: è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œ å¦‚æœé‡è½½äº† <tt class="docutils literal"><span class="pre"><span class="Operator">==</span></span></tt> è¿ç®—ç¬¦ï¼Œ<tt class="docutils literal"><span class="pre"><span class="Operator">!=</span></span></tt> è¿ç®—ç¬¦å°†è‡ªåŠ¨å¯ç”¨å¹¶ä¸”æ­£ç¡®è¿ä½œã€‚ (é™¤äº† IEEE æµ®ç‚¹æ•° â€”â€” NaN ç ´åäº†åŸºæœ¬çš„å¸ƒå°”é€»è¾‘)</p>
<p><tt class="docutils literal"><span class="pre"><span class="Identifier">a</span> <span class="Operator">&gt;</span> <span class="Identifier">b</span></span></tt> è¢«è½¬æ¢ä¸º <tt class="docutils literal"><span class="pre"><span class="Identifier">b</span> <span class="Operator">&lt;</span> <span class="Identifier">a</span></span></tt>ã€‚ <tt class="docutils literal"><span class="pre"><span class="Identifier">a</span> <span class="Keyword">in</span> <span class="Identifier">b</span></span></tt> è¢«è½¬æ¢ä¸º <tt class="docutils literal"><span class="pre"><span class="Identifier">contains</span><span class="Punctuation">(</span><span class="Identifier">b</span><span class="Punctuation">,</span> <span class="Identifier">a</span><span class="Punctuation">)</span></span></tt>ã€‚ <tt class="docutils literal"><span class="pre"><span class="Keyword">notin</span></span></tt> å’Œ <tt class="docutils literal"><span class="pre"><span class="Keyword">isnot</span></span></tt> è¯­ä¹‰æ˜¾ç„¶ã€‚</p>
<p>æ¨¡æ¿å¯¹äºæƒ°æ€§æ±‚å€¼ç‰¹åˆ«æœ‰ç”¨ã€‚è€ƒè™‘ä¸€ä¸ªç®€å•å¤„ç†æ—¥å¿—çš„è¿‡ç¨‹:</p>
<p><pre class="listing">
<span class="Keyword">const</span>
  <span class="Identifier">debug</span> <span class="Operator">=</span> <span class="Identifier">true</span>

<span class="Keyword">proc</span> <span class="Identifier">log</span><span class="Punctuation">(</span><span class="Identifier">msg</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">inline</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span>
  <span class="Keyword">if</span> <span class="Identifier">debug</span><span class="Punctuation">:</span> <span class="Identifier">stdout</span><span class="Operator">.</span><span class="Identifier">writeLine</span><span class="Punctuation">(</span><span class="Identifier">msg</span><span class="Punctuation">)</span>

<span class="Keyword">var</span>
  <span class="Identifier">x</span> <span class="Operator">=</span> <span class="DecNumber">4</span>
<span class="Identifier">log</span><span class="Punctuation">(</span><span class="StringLit">&quot;x has the value: &quot;</span> <span class="Operator">&amp;</span> <span class="Operator">$</span><span class="Identifier">x</span><span class="Punctuation">)</span></pre></p>
<p>è¿™æ®µä»£ç æœ‰ä¸ªç¼ºç‚¹: å¦‚æœå“ªå¤©å°† <tt class="docutils literal"><span class="pre"><span class="Identifier">debug</span></span></tt> è®¾ä¸º falseï¼Œé‚£ä¹ˆä»ä¼šæ‰§è¡Œç›¸å½“æ˜‚è´µçš„ <tt class="docutils literal"><span class="pre"><span class="Operator">$</span></span></tt> å’Œ <tt class="docutils literal"><span class="pre"><span class="Operator">&amp;</span></span></tt> æ“ä½œ! (å¯¹è¿‡ç¨‹çš„å‚æ•°è¯„ä¼°æ€»æ˜¯<em>å³åˆ»æ‰§è¡Œ</em>çš„)ã€‚</p>
<p>å°† <tt class="docutils literal"><span class="pre"><span class="Identifier">log</span></span></tt> è¿‡ç¨‹è½¬æ¢ä¸ºæ¨¡æ¿å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜:</p>
<p><pre class="listing">
<span class="Keyword">const</span>
  <span class="Identifier">debug</span> <span class="Operator">=</span> <span class="Identifier">true</span>

<span class="Keyword">template</span> <span class="Identifier">log</span><span class="Punctuation">(</span><span class="Identifier">msg</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Keyword">if</span> <span class="Identifier">debug</span><span class="Punctuation">:</span> <span class="Identifier">stdout</span><span class="Operator">.</span><span class="Identifier">writeLine</span><span class="Punctuation">(</span><span class="Identifier">msg</span><span class="Punctuation">)</span>

<span class="Keyword">var</span>
  <span class="Identifier">x</span> <span class="Operator">=</span> <span class="DecNumber">4</span>
<span class="Identifier">log</span><span class="Punctuation">(</span><span class="StringLit">&quot;x has the value: &quot;</span> <span class="Operator">&amp;</span> <span class="Operator">$</span><span class="Identifier">x</span><span class="Punctuation">)</span></pre></p>
<p>å‚æ•°çš„ç±»å‹å¯ä»¥æ˜¯æ™®é€šç±»å‹æˆ–å…ƒç±»å‹ <tt class="docutils literal"><span class="pre"><span class="Identifier">untyped</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">typed</span></span></tt> æˆ– <tt class="docutils literal"><span class="pre"><span class="Keyword">type</span></span></tt>ã€‚ <tt class="docutils literal"><span class="pre"><span class="Keyword">type</span></span></tt> è¡¨ç¤ºåªèƒ½å°†ç±»å‹ç¬¦å· ä½œä¸ºå‚æ•°ç»™å‡ºï¼Œè€Œ <tt class="docutils literal"><span class="pre"><span class="Identifier">untyped</span></span></tt> è¡¨ç¤ºåœ¨å°†è¡¨è¾¾å¼ä¼ é€’ç»™æ¨¡æ¿ä¹‹å‰ä¸æ‰§è¡Œç¬¦å·æŸ¥æ‰¾å’Œç±»å‹è§£æã€‚</p>
<p>å¦‚æœæ¨¡æ¿æ²¡æœ‰æ˜ç¡®çš„è¿”å›ç±»å‹ï¼Œå®ƒå°†ä½¿ç”¨ <tt class="docutils literal"><span class="pre"><span class="Identifier">void</span></span></tt> ä»¥ä¸è¿‡ç¨‹å’Œæ–¹æ³•ä¿æŒä¸€è‡´ã€‚</p>
<p>è¦å°†è¯­å¥å—ä¼ é€’ç»™æ¨¡æ¿ï¼Œè¯·å°†æœ€åä¸€ä¸ªå‚æ•°è®¾ä¸º <tt class="docutils literal"><span class="pre"><span class="Identifier">untyped</span></span></tt>:</p>
<p><pre class="listing">
<span class="Keyword">template</span> <span class="Identifier">withFile</span><span class="Punctuation">(</span><span class="Identifier">f</span><span class="Punctuation">:</span> <span class="Identifier">untyped</span><span class="Punctuation">,</span> <span class="Identifier">filename</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">mode</span><span class="Punctuation">:</span> <span class="Identifier">FileMode</span><span class="Punctuation">,</span>
                  <span class="Identifier">body</span><span class="Punctuation">:</span> <span class="Identifier">untyped</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Keyword">let</span> <span class="Identifier">fn</span> <span class="Operator">=</span> <span class="Identifier">filename</span>
  <span class="Keyword">var</span> <span class="Identifier">f</span><span class="Punctuation">:</span> <span class="Identifier">File</span>
  <span class="Keyword">if</span> <span class="Identifier">open</span><span class="Punctuation">(</span><span class="Identifier">f</span><span class="Punctuation">,</span> <span class="Identifier">fn</span><span class="Punctuation">,</span> <span class="Identifier">mode</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
    <span class="Keyword">try</span><span class="Punctuation">:</span>
      <span class="Identifier">body</span>
    <span class="Keyword">finally</span><span class="Punctuation">:</span>
      <span class="Identifier">close</span><span class="Punctuation">(</span><span class="Identifier">f</span><span class="Punctuation">)</span>
  <span class="Keyword">else</span><span class="Punctuation">:</span>
    <span class="Identifier">quit</span><span class="Punctuation">(</span><span class="StringLit">&quot;cannot open: &quot;</span> <span class="Operator">&amp;</span> <span class="Identifier">fn</span><span class="Punctuation">)</span>

<span class="Identifier">withFile</span><span class="Punctuation">(</span><span class="Identifier">txt</span><span class="Punctuation">,</span> <span class="StringLit">&quot;ttempl3.txt&quot;</span><span class="Punctuation">,</span> <span class="Identifier">fmWrite</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Identifier">txt</span><span class="Operator">.</span><span class="Identifier">writeLine</span><span class="Punctuation">(</span><span class="StringLit">&quot;line 1&quot;</span><span class="Punctuation">)</span>
  <span class="Identifier">txt</span><span class="Operator">.</span><span class="Identifier">writeLine</span><span class="Punctuation">(</span><span class="StringLit">&quot;line 2&quot;</span><span class="Punctuation">)</span></pre></p>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæœ‰ä¸¤ä¸ª <tt class="docutils literal"><span class="pre"><span class="Identifier">writeLine</span></span></tt> è¯­å¥ç»‘å®šåˆ° <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt> å‚æ•°ã€‚<tt class="docutils literal"><span class="pre"><span class="Identifier">withFile</span></span></tt> æ¨¡æ¿åŒ…å«æ ·æ¿ä»£ç ï¼Œ è¿™æœ‰åŠ©äºé¿å…ä¸€ä¸ªå¸¸è§çš„é”™è¯¯: å¿˜è®°å…³é—­æ–‡ä»¶ã€‚æ³¨æ„ <tt class="docutils literal"><span class="pre"><span class="Keyword">let</span> <span class="Identifier">fn</span> <span class="Operator">=</span> <span class="Identifier">filename</span></span></tt> è¯­å¥æ˜¯å¦‚ä½•ç¡®ä¿ <tt class="docutils literal"><span class="pre"><span class="Identifier">filename</span></span></tt> åªè¯„ä¼°ä¸€æ¬¡çš„ã€‚</p>

<h2><a class="toc-backref" id="æ¨¡æ¿-ä¾‹colon-æå‡è¿‡ç¨‹" href="#æ¨¡æ¿-ä¾‹colon-æå‡è¿‡ç¨‹">ä¾‹: æå‡è¿‡ç¨‹</a></h2><p><pre class="listing">
<span class="Keyword">import</span> <span class="Identifier">std</span><span class="Operator">/</span><span class="Identifier">math</span>

<span class="Keyword">template</span> <span class="Identifier">liftScalarProc</span><span class="Punctuation">(</span><span class="Identifier">fname</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Comment">## Lift a proc taking one scalar parameter and returning a</span>
  <span class="Comment">## scalar value (eg `proc sssss[T](x: T): float`),</span>
  <span class="Comment">## to provide templated procs that can handle a single</span>
  <span class="Comment">## parameter of seq[T] or nested seq[seq[]] or the same type</span>
  <span class="Comment">##</span>
  <span class="Comment">##   ```Nim</span>
  <span class="Comment">##   liftScalarProc(abs)</span>
  <span class="Comment">##   # now abs(@[@[1,-2], @[-2,-3]]) == @[@[1,2], @[2,3]]</span>
  <span class="Comment">##   ```</span>
  <span class="Keyword">proc</span> <span class="Identifier">fname</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">openarray</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">auto</span> <span class="Operator">=</span>
    <span class="Keyword">var</span> <span class="Identifier">temp</span><span class="Punctuation">:</span> <span class="Identifier">T</span>
    <span class="Keyword">type</span> <span class="Identifier">outType</span> <span class="Operator">=</span> <span class="Identifier">typeof</span><span class="Punctuation">(</span><span class="Identifier">fname</span><span class="Punctuation">(</span><span class="Identifier">temp</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
    <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">newSeq</span><span class="Punctuation">[</span><span class="Identifier">outType</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span>
    <span class="Keyword">for</span> <span class="Identifier">i</span> <span class="Keyword">in</span> <span class="FloatNumber">0.</span><span class="Operator">.&lt;</span><span class="Identifier">x</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">:</span>
      <span class="Identifier">result</span><span class="Punctuation">[</span><span class="Identifier">i</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">fname</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">[</span><span class="Identifier">i</span><span class="Punctuation">]</span><span class="Punctuation">)</span>

<span class="Identifier">liftScalarProc</span><span class="Punctuation">(</span><span class="Identifier">sqrt</span><span class="Punctuation">)</span>   <span class="Comment"># make sqrt() work for sequences</span>
<span class="Identifier">echo</span> <span class="Identifier">sqrt</span><span class="Punctuation">(</span><span class="Operator">@</span><span class="Punctuation">[</span><span class="FloatNumber">4.0</span><span class="Punctuation">,</span> <span class="FloatNumber">16.0</span><span class="Punctuation">,</span> <span class="FloatNumber">25.0</span><span class="Punctuation">,</span> <span class="FloatNumber">36.0</span><span class="Punctuation">]</span><span class="Punctuation">)</span>   <span class="Comment"># =&gt; @[2.0, 4.0, 5.0, 6.0]</span></pre></p>

<h1><a class="toc-backref" id="ç¼–è¯‘æˆ-javascript" href="#ç¼–è¯‘æˆ-javascript">ç¼–è¯‘æˆ JavaScript</a></h1><p>Nim ä»£ç å¯ç¼–è¯‘æˆ JavaScriptã€‚ä½†ä¸ºäº†å†™å‡ºä¸ JavaScript å…¼å®¹çš„ä»£ç ï¼Œä½ åº”éµå¾ªä¸€ä¸‹å‡ æ¡:</p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Keyword">addr</span></span></tt> å’Œ <tt class="docutils literal"><span class="pre"><span class="Keyword">ptr</span></span></tt> åœ¨ JavaScript ä¸­çš„è¯­ä¹‰ç•¥æœ‰ä¸åŒã€‚å¦‚æœä½ ä¸ç¡®å®šå®ƒä»¬æ˜¯å¦‚ä½•è½¬æ¢ä¸º JavaScript çš„ï¼Œ å»ºè®®ä½ é¿å…ä½¿ç”¨å®ƒä»¬ã€‚</li>
<li>JavaScript ä¸­çš„ <tt class="docutils literal"><span class="pre"><span class="Keyword">cast</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span></span></tt> è¢«ç¿»è¯‘ä¸º <tt class="docutils literal"><span class="pre"><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span></span></tt>ï¼Œé™¤äº†æœ‰ç¬¦å· / æ— ç¬¦å·æ•´æ•°ä¹‹é—´çš„è½¬æ¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ å®ƒçš„è¡Œä¸ºç±»ä¼¼äº C è¯­è¨€ä¸­çš„é™æ€è½¬æ¢ã€‚</li>
<li>JavaScript ä¸­çš„ <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt> è¡¨ç¤º JavaScript å­—ç¬¦ä¸²ã€‚ä¸€ç§å¥½çš„åšæ³•æ˜¯åœ¨ä»…åœ¨è¯­ä¹‰åˆé€‚æ—¶æ‰ä½¿ç”¨ <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt> ä¾‹å¦‚ï¼Œä¸è¦ä½¿ç”¨ <tt class="docutils literal"><span class="pre"><span class="Identifier">cstring</span></span></tt> ä½œä¸ºäºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒºã€‚</li>
</ul>

<h1><a class="toc-backref" id="ç¬¬-3-éƒ¨åˆ†" href="#ç¬¬-3-éƒ¨åˆ†">ç¬¬ 3 éƒ¨åˆ†</a></h1><p>ä¸‹éƒ¨åˆ†å°†ç”¨æ•´ç« è®²è¿°åŸºäºå®çš„å…ƒç¼–ç¨‹: <a class="reference external" href="tut3.html">ç¬¬ III éƒ¨åˆ†</a>. </p>
</p>
    
  </div>
</div>

      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br>
        <small style="color: var(--hint);">Made with Nim. Generated: 2022-10-28 03:57:27 UTC</small>
      </div>
    </div>
  </div>
  
</body>
</html>
